#!/usr/bin/env bash

install_dir="$(uci -qX get ffdd.sys.install_dir)"
version="$(head -n3 "$install_dir"/init_server.sh | grep -oP '(?<=^#version=).+' | tr -d '"')"
rev="$(git --git-dir="$install_dir"/.git describe --all --abbrev=0 | cut -f2 -d"/")"
commit="$(git --git-dir="$install_dir"/.git show --oneline -s | awk '{print $1}')"

if [ "$install_dir" != '' ]; then
	printf '%s - %s (%s)\n' "$version" "$rev" "$commit"
else
	printf 'n.a.\n'
fi

exit 0
