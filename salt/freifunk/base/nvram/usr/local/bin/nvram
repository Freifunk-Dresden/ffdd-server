#!/usr/bin/env bash
### This file managed by Salt, do not edit by hand! ###

case "$1" in
	show)
		cat /etc/nvram.conf
	;;

	get)
		sed -n "/^$2/{s#^.*=##;p}" /etc/nvram.conf
	;;

	set)
		sed -i "s/${2}=.*/${2}=${3}/g" /etc/nvram.conf
	;;

	unset)
		sed -i "s/${2}=.*/${2}=/g" /etc/nvram.conf
	;;

	version)
		version=$(grep -oP '(?<=^#version=).+' "$(nvram get install_dir)"/init_server.sh | tr -d '"')
		fix=$(grep -oP '(?<=^#fix=).+' "$(nvram get install_dir)"/init_server.sh | tr -d '"')
		branch=$(nvram get branch)
		[[ -n "$fix" ]] && printf '%s_fix%s - Branch: %s\n' "$version" "$fix" "$branch" || printf '%s - Branch: %s\n' "$version" "$branch"
	;;

	*)
		printf 'usage: nvram [get name] [set name value] [unset name] [show] [version]\n';
		exit 0
	;;
esac
